#include <stdlib.h>
#include <stdio.h>
#include <string.h>
#include <unistd.h>
#include "platform.h"
#include "picojpeg.h"

#define TEST_BASE 0x10041000
#define TRAIN_BASE 0x10041100
#define RESULT_REG 0x10041ff8
#define STATUS_REG 0x10041ffc

#define GIE 0x100507f8
#define TX_PING_LEN 0x100507f4
#define TX_PING_CON 0x100507fc
#define TX_BASE 0x10050000
#define RX_BASE 0x10051000
#define RX_PING_CON 0x100517fc
#define MDIO_ADDR 0x100507e4
#define MDIO_WR 0x100507e8
#define MDIO_RD 0x100507ec
#define MDIO_CTRL 0x100507f0


uint32_t train_set[11][37] = {{4194303,4194303,4194303,4194303,4186367,4161599,4063263,4071183,3948423,3702663,3735491,3735491,3211203,3211235,3211235,3276771,3276771,3276771,3276771,3276771,3276771,3276771,3276771,3211235,3211235,3211203,3735495,3702663,3948431,3940111,4063263,4128831,4178431,4194303,4194303,4194303,4194303},
		{4194303,4194303,4194303,4194303,4193535,4192511,4190463,4178175,4129023,3938559,3963135,4061439,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4192511,4194303,4194303,4194303,4194303},
		{4194303,4194303,4194303,4194303,4178431,4063295,3932191,3964431,3997575,4194183,4194247,4194247,4194247,4194247,4194247,4194183,4194063,4193807,4193311,4192319,4190335,4178431,4162559,4130815,4071423,3948543,3702783,3735551,3735551,3211263,3145731,3145731,3145731,4194303,4194303,4194303,4194303},
		{4194303,4194303,4194303,4194303,4178431,4063295,3932191,3997215,4062991,4194063,4194191,4194191,4194191,4194191,4194063,4193823,4193343,4129023,4129279,4128831,4193807,4194063,4194183,4194247,4194247,4194247,4194247,4194183,3931919,3800591,3670047,3932287,4162559,4194303,4194303,4194303,4194303},
		{4194303,4194303,4194303,4194303,4193823,4193823,4193311,4193311,4192287,4192287,4190495,4186911,4186911,4179743,4165407,4165407,4136735,4079391,3948319,3964703,3735327,3276575,2227999,2097153,2097153,2097153,4194079,4194079,4194079,4194079,4194079,4194079,4194079,4194303,4194303,4194303,4194303},
		{4194303,4194303,4194303,4194303,4063247,4063247,4063247,4079615,3948543,3964927,3964927,3964927,3964927,3964927,3964927,3932671,3932223,3932191,4193295,4194063,4194183,4194247,4194247,4194247,4194247,4194247,4194183,4194183,4194063,3800095,3670047,3670143,4064255,4194303,4194303,4194303,4194303},
		{4194303,4194303,4194303,4194303,4192287,4186119,4161543,4130807,4132863,4071423,3948543,3964927,3702783,3735551,3735551,3731583,3719199,3178511,3153671,3162051,3178435,3211235,3211235,3735523,3735523,3735523,3702755,3964867,3948423,4071175,4128783,4161567,4186367,4194303,4194303,4194303,4194303},
		{4194303,4194303,4194303,4194303,3145731,3145731,3145731,4194247,4194247,4194191,4194191,4194079,4194079,4193855,4193855,4193407,4193407,4192511,4192511,4190463,4190719,4190719,4187135,4187135,4178943,4179967,4179967,4163583,4163583,4165631,4165631,4165631,4132863,4194303,4194303,4194303,4194303},
		{4194303,4194303,4194303,4194303,4186367,4128831,4063263,3940111,3964807,3702727,3735495,3735495,3735495,3964871,3964815,4071199,4128831,4161599,4063263,3948303,3702663,3735491,3211235,3276771,3276771,3276771,3211235,3211203,3702663,3686151,3932175,4128799,4178175,4194303,4194303,4194303,4194303},
		{4194303,4194303,4194303,4194303,4186367,4128831,4063263,3948047,3702671,3735431,3211207,3211203,3276771,3276771,3211235,3211203,3211203,3702659,3686147,3932195,4063331,4178403,4194243,4194247,4194247,4194247,4194191,4194063,4193823,4062271,3932287,3932415,4130815,4194303,4194303,4194303,4194303},
		{4194303,4194303,4194303,4194303,3211256,3211256,3702768,3948529,3948513,4071363,4071363,4132743,4165519,4163343,4178463,4178495,4186175,4190335,4190335,4186239,4186175,4178463,4179487,4163343,4132751,4136839,4071363,3948483,3948513,3702768,3211248,3211256,2228216,4194303,4194303,4194303,4194303}};
uint16_t offset;
uint8_t char_list[11] = {'0','1','2','3','4','5','6','7','8','9','X'};
uint8_t result_list[10][19];
uint8_t dest_mac_rx[6];
uint8_t source_mac_rx[6];
uint8_t eth_type_rx[2];
uint8_t dest_ip_rx[4];
uint8_t receive_buf[550];
uint8_t image_buf[39000];
uint8_t send_buf[200];
uint32_t ip_head[14];
uint16_t tx_index;
uint16_t dest_port;
uint16_t g_nInFileSize;
uint16_t g_nInFileOfs;
uint8_t * pImage;
pjpeg_image_info_t image_info;
int mcu_x;
int mcu_y;
uint32_t row_pitch;
uint8_t status;
uint32_t decoded_width,decoded_height;
uint32_t row_blocks_per_mcu, col_blocks_per_mcu;
uint32_t k;
uint8_t * char_block;
uint8_t temp;
uint32_t sum;
uint32_t test_set[37];
uint32_t min;
uint8_t minindex;
uint8_t jpgindex;
volatile uint16_t receive_len;

void eth_ini();
int receive_udp(uint8_t * buf);
void send_udp(uint16_t data_len,uint8_t * buf);



int main(void)
{
	uint32_t * vga_ptr;
	vga_ptr = (uint32_t*)0x10010000;
	k=0;
	for (int i=0; i<10;i++)
		for (int j=0;j<18;j++){

			*(vga_ptr+k) = k % 11;
			k++;
		}
	vga_ptr = (uint32_t*)0x10010ffc;
	*vga_ptr = 1;
	while(1){

	}
	return 0;

}


